# Terraform-Ansible-Deployment

## üá¨üáß Automated Deployment and Configuration of iTop on Proxmox LXC Containers

This project provides a set of Infrastructure as Code (IaC) scripts using **Terraform** for Proxmox LXC container provisioning and **Ansible** for automated software installation and configuration. The primary goal is to deploy and set up an **iTop** (IT Operations Portal) instance efficiently and repeatably within a Proxmox Virtual Environment.

This project was developed as my **Final Project (Absolventsk√° pr√°ce)** at a **Higher Vocational School (Vy≈°≈°√≠ odborn√° ≈°kola)**.

-----

### Features

  * **Proxmox LXC Provisioning:** Automatically creates a Debian 12 LXC container on Proxmox using Terraform.
  * **Automated Software Installation:** Installs and configures necessary components including:
      * **PHP:** Installs PHP (version 8.1 by default, with an option for 7.4) and essential extensions for iTop.
      * **Apache2:** Sets up the Apache web server.
      * **MariaDB:** Installs MariaDB 11.5, configures root password, and sets up remote access.
      * **iTop CMDB:** Downloads and deploys iTop (version 3.2.0 by default, with options for 3.1.1, 3.1.2) to the web server.
      * **iTop Toolkit:** Installs the iTop Toolkit for post-installation tasks.
  * **Dynamic IP Handling:** Automatically fetches the LXC's IP address and adds it to an Ansible inventory file.
  * **Container Renaming:** Renames the created LXC container based on the installed PHP and iTop versions for better identification.
  * **Customizable:** Easily adaptable to different PHP and iTop versions by uncommenting relevant Ansible playbooks.

-----

### Prerequisites

Before running these scripts, ensure you have the following:

  * **Proxmox VE Server:** A running Proxmox Virtual Environment.
  * **SSH Access to Proxmox:** Root SSH access to your Proxmox host. The Bash script uses `ssh root@$PROXMOX_IP`.
  * **Terraform:** [Terraform](https://www.terraform.io/downloads.html) installed on your local machine.
  * **Ansible:** [Ansible](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html) installed on your local machine.
  * **SSH Key:** An SSH public/private key pair configured. The `terraform.tf` script expects the public key at `/home/idk/.ssh/id_rsa.pub` on the Proxmox host. The Bash script uses the private key at `/home/idk/.ssh/id_rsa` for Ansible connections to the LXC container. **Ensure these paths are correct for your setup.**
  * **Required Terraform Provider:** The `Telmate/proxmox` provider for Terraform.
  * **Network Access:** Ensure your local machine can reach the Proxmox API URL and the provisioned LXC container.

-----

### Security Considerations & Sensitive Data Handling

**It is CRUCIAL to understand how sensitive information is handled in this project, especially for production environments:**

  * **Hardcoded Placeholders:** The provided Terraform script (`Terraform/.tf`) and MariaDB Ansible playbook (`ansible/03-MariaDB.yml`) contain **placeholder values** for sensitive information (e.g., `IP.Address`, `username`, `password`, `root_db_password`).
      * **NEVER** hardcode actual passwords or sensitive IPs directly into your `main.tf` or Ansible playbooks when deploying to a real environment.
  * **Bash Script `PROXMOX_IP`:** The `Skript.sh` requires you to manually set `PROXMOX_IP`. This should be replaced with your Proxmox server's IP address.
  * **Recommended Secure Practices (for Production):**
      * **Terraform Variables:** Use [Terraform variables](https://developer.hashicorp.com/terraform/language/values/variables) to pass sensitive values during runtime (e.g., via environment variables like `TF_VAR_your_variable` or interactive prompts).
      * **.tfvars files (Excluded from Git):** If using `.tfvars` files, ensure `terraform.tfvars` (and similar files) are listed in your `.gitignore` to prevent committing sensitive data.
      * **Ansible Vault:** For sensitive data in Ansible playbooks (like `root_db_password` in `03-MariaDB.yml`), use [Ansible Vault](https://docs.ansible.com/ansible/latest/user_guide/vault.html) to encrypt these values.
      * **Proxmox API Tokens:** For increased security, configure and use [Proxmox API tokens](https://www.google.com/search?q=https://pve.proxmox.com/pve-docs/api-viewer/%23/access/token) instead of username/password authentication in the Terraform `proxmox` provider.
      * **SSH Key Management:** Ensure your SSH private key (`/home/idk/.ssh/id_rsa`) is securely stored and protected.

-----

### Project Structure

```
.
‚îú‚îÄ‚îÄ ansible/
‚îÇ   ‚îú‚îÄ‚îÄ 01-Preinstall.yml             # Installs basic packages (wget, git, unzip, etc.)
‚îÇ   ‚îú‚îÄ‚îÄ 02-PHP-7.4.yml                # Installs PHP 7.4 and extensions (legacy option)
‚îÇ   ‚îú‚îÄ‚îÄ 02-PHP-8.1.yml                # Installs PHP 8.1 and extensions (default)
‚îÇ   ‚îú‚îÄ‚îÄ 03-MariaDB.yml                # Installs MariaDB server and client, sets up root password
‚îÇ   ‚îú‚îÄ‚îÄ 04-iTop-3.1.1.yml             # Installs iTop 3.1.1 (legacy option)
‚îÇ   ‚îú‚îÄ‚îÄ 04-iTop-3.1.2.yml             # Installs iTop 3.1.2 (legacy option)
‚îÇ   ‚îú‚îÄ‚îÄ 04-iTop-3.2.0.yml             # Installs iTop 3.2.0 (default)
‚îÇ   ‚îú‚îÄ‚îÄ 04-iTop-3.2.0-2.yml           # Installs iTop 3.2.0-2 (legacy option)
‚îÇ   ‚îî‚îÄ‚îÄ 05-Toolkit.yml                # Downloads and extracts iTop Toolkit
‚îú‚îÄ‚îÄ Skript.sh                         # Main Bash script to orchestrate Terraform and Ansible
‚îú‚îÄ‚îÄ Terraform/
‚îÇ   ‚îî‚îÄ‚îÄ .tf                           # Terraform configuration for Proxmox LXC creation
‚îú‚îÄ‚îÄ .gitignore                        # Specifies intentionally untracked files to ignore
‚îî‚îÄ‚îÄ README.md                         # This file
‚îî‚îÄ‚îÄ LICENSE                           # MIT License for the project
```

-----

### Setup and Usage

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/YourUsername/Terraform-Ansible-Deployment.git
    cd Terraform-Ansible-Deployment
    ```
2.  **Navigate to the Terraform directory and initialize:**
    ```bash
    cd Terraform/
    terraform init
    ```
    **Note:** If using variables for sensitive data, ensure they are set now (e.g., via environment variables or a `.tfvars` file that you will NOT commit).
    ```bash
    cd .. # Go back to the root directory
    ```
3.  **Edit `Skript.sh`:**
      * Open `Skript.sh` and replace `PROXMOX_IP="..."` with the actual IP address of your Proxmox server.
      * Ensure the paths to your SSH private key (`/home/idk/.ssh/id_rsa`) are correct within `Skript.sh` and the Terraform configuration.
      * **Important:** Review the commented-out Ansible playbooks in `Skript.sh`. Uncomment the specific PHP and iTop versions you wish to install. By default, PHP 8.1 and iTop 3.2.0 are chosen.
4.  **Run the main deployment script:**
    ```bash
    chmod +x Skript.sh
    ./Skript.sh
    ```
    The script will:
      * Run `terraform apply` to create the LXC container.
      * Obtain the LXC's VMID and IP address.
      * Start the LXC via SSH.
      * Dynamically update `ansible/hosts.ini` with the new LXC IP.
      * Execute the selected Ansible playbooks to install and configure software.
      * Rename the LXC container.
      * Output the final IP address of the deployed iTop instance.

-----

### After Deployment

  * Once the script completes, you can access your iTop instance via the displayed IP address in your web browser. You will then need to complete the iTop web-based installation wizard.
  * Remember to clean up your `ansible/hosts.ini` file if you run the script multiple times, or consider adding logic to `Skript.sh` to remove old entries before adding new ones.

-----

## üá®üáø Nasazen√≠ a konfigurace iTopu na Proxmox LXC kontejnerech

Tento projekt poskytuje sadu skript≈Ø **Infrastructure as Code (IaC)**, kter√© vyu≈æ√≠vaj√≠ **Terraform** pro z≈ôizov√°n√≠ LXC kontejner≈Ø v Proxmoxu a **Ansible** pro automatizovanou instalaci a konfiguraci softwaru. Prim√°rn√≠m c√≠lem je efektivnƒõ a opakovanƒõ nasadit a nastavit instanci **iTop** (IT Operations Portal) v prost≈ôed√≠ Proxmox Virtual Environment.

Tento projekt byl vyvinut jako moje **Absolventsk√° pr√°ce** na **Vy≈°≈°√≠ odborn√© ≈°kole**.

-----

### Vlastnosti

  * **Z≈ôizov√°n√≠ Proxmox LXC:** Automaticky vytv√°≈ô√≠ Debian 12 LXC kontejner na Proxmoxu pomoc√≠ Terraformu.
  * **Automatizovan√° instalace softwaru:** Instaluje a konfiguruje nezbytn√© komponenty vƒçetnƒõ:
      * **PHP:** Instaluje PHP (v√Ωchoz√≠ verze 8.1, s mo≈ænost√≠ 7.4) a z√°kladn√≠ roz≈°√≠≈ôen√≠ pro iTop.
      * **Apache2:** Nastav√≠ webov√Ω server Apache.
      * **MariaDB:** Instaluje MariaDB 11.5, konfiguruje root heslo a nastav√≠ vzd√°len√Ω p≈ô√≠stup.
      * **iTop CMDB:** St√°hne a nasad√≠ iTop (v√Ωchoz√≠ verze 3.2.0, s mo≈ænostmi 3.1.1, 3.1.2) na webov√Ω server.
      * **iTop Toolkit:** Nainstaluje iTop Toolkit pro poinstalaƒçn√≠ √∫koly.
  * **Dynamick√© zpracov√°n√≠ IP adres:** Automaticky z√≠sk√° IP adresu LXC a p≈ôid√° ji do souboru s invent√°≈ôem Ansible.
  * **P≈ôejmenov√°n√≠ kontejneru:** P≈ôejmenuje vytvo≈ôen√Ω LXC kontejner na z√°kladƒõ nainstalovan√Ωch verz√≠ PHP a iTop pro lep≈°√≠ identifikaci.
  * **P≈ôizp≈Øsobiteln√©:** Snadno p≈ôizp≈Øsobiteln√© pro r≈Øzn√© verze PHP a iTop odkomentov√°n√≠m p≈ô√≠slu≈°n√Ωch Ansible playbook≈Ø.

-----

### P≈ôedpoklady

P≈ôed spu≈°tƒõn√≠m tƒõchto skript≈Ø se ujistƒõte, ≈æe m√°te n√°sleduj√≠c√≠:

  * **Proxmox VE Server:** Spu≈°tƒõn√Ω Proxmox Virtual Environment.
  * **SSH P≈ô√≠stup k Proxmoxu:** Root SSH p≈ô√≠stup k va≈°emu Proxmox hostiteli. Bash skript pou≈æ√≠v√° `ssh root@$PROXMOX_IP`.
  * **Terraform:** [Terraform](https://www.terraform.io/downloads.html) nainstalovan√Ω na va≈°em lok√°ln√≠m poƒç√≠taƒçi.
  * **Ansible:** [Ansible](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html) nainstalovan√Ω na va≈°em lok√°ln√≠m poƒç√≠taƒçi.
  * **SSH kl√≠ƒç:** Nakonfigurovan√Ω p√°r ve≈ôejn√©ho/priv√°tn√≠ho SSH kl√≠ƒçe. Skript `terraform.tf` oƒçek√°v√° ve≈ôejn√Ω kl√≠ƒç na `/home/idk/.ssh/id_rsa.pub` na Proxmox hostiteli. Bash skript pou≈æ√≠v√° priv√°tn√≠ kl√≠ƒç na `/home/idk/.ssh/id_rsa` pro p≈ôipojen√≠ Ansible ke kontejneru LXC. **Ujistƒõte se, ≈æe tyto cesty jsou pro va≈°i konfiguraci spr√°vn√©.**
  * **Po≈æadovan√Ω Terraform provider:** Provider `Telmate/proxmox` pro Terraform.
  * **S√≠≈•ov√Ω p≈ô√≠stup:** Ujistƒõte se, ≈æe v√°≈° lok√°ln√≠ poƒç√≠taƒç m≈Ø≈æe dos√°hnout API URL Proxmoxu a z≈ô√≠zen√©ho kontejneru LXC.

-----

### Bezpeƒçnostn√≠ aspekty a nakl√°d√°n√≠ s citliv√Ωmi daty

**Je KL√çƒåOV√â pochopit, jak se s citliv√Ωmi informacemi v tomto projektu zach√°z√≠, zejm√©na pro produkƒçn√≠ prost≈ôed√≠:**

  * **Z√°stupn√© hodnoty (Placeholdery):** Poskytnut√Ω Terraform skript (`Terraform/.tf`) a Ansible playbook pro MariaDB (`ansible/03-MariaDB.yml`) obsahuj√≠ **z√°stupn√© hodnoty** pro citliv√© informace (nap≈ô. `IP.Address`, `username`, `password`, `root_db_password`).
      * **NIKDY** nek√≥dujte skuteƒçn√° hesla nebo citliv√© IP adresy p≈ô√≠mo do `main.tf` nebo Ansible playbook≈Ø p≈ôi nasazov√°n√≠ do re√°ln√©ho prost≈ôed√≠.
  * **Bash Skript `PROXMOX_IP`:** Skript `Skript.sh` vy≈æaduje ruƒçn√≠ nastaven√≠ `PROXMOX_IP`. Toto by mƒõlo b√Ωt nahrazeno skuteƒçnou IP adresou va≈°eho Proxmox serveru.
  * **Spr√°va SSH kl√≠ƒç≈Ø:** Ujistƒõte se, ≈æe v√°≈° priv√°tn√≠ SSH kl√≠ƒç (`/home/idk/.ssh/id_rsa`) je bezpeƒçnƒõ ulo≈æen a chr√°nƒõn.
  * **Doporuƒçen√© bezpeƒçn√© postupy (pro produkci):**
      * **Terraform Promƒõnn√©:** Pou≈æijte [Terraform promƒõnn√©](https://developer.hashicorp.com/terraform/language/values/variables) pro p≈ôed√°v√°n√≠ citliv√Ωch hodnot za bƒõhu (nap≈ô. prost≈ôednictv√≠m promƒõnn√Ωch prost≈ôed√≠ jako `TF_VAR_your_variable` nebo interaktivn√≠ch dotaz≈Ø).
      * **.tfvars soubory (vy≈ôazen√© z Gitu):** Pokud pou≈æ√≠v√°te soubory `.tfvars`, ujistƒõte se, ≈æe `terraform.tfvars` (a podobn√© soubory) jsou uvedeny ve va≈°em `.gitignore`, abyste zabr√°nili odes√≠l√°n√≠ citliv√Ωch dat.
      * **Ansible Vault:** Pro citliv√° data v Ansible playbook√°ch (jako `root_db_password` v `03-MariaDB.yml`) pou≈æijte [Ansible Vault](https://docs.ansible.com/ansible/latest/user_guide/vault.html) k za≈°ifrov√°n√≠ tƒõchto hodnot.
      * **Proxmox API Tokeny:** Pro zv√Ω≈°en√≠ bezpeƒçnosti nakonfigurujte a pou≈æijte [Proxmox API tokeny](https://www.google.com/search?q=https://pve.proxmox.com/pve-docs/api-viewer/%23/access/token) nam√≠sto ovƒõ≈ôov√°n√≠ u≈æivatelsk√Ωm jm√©nem a heslem v provideru `proxmox` Terraformu.

-----

### Struktura projektu

```
.
‚îú‚îÄ‚îÄ ansible/
‚îÇ   ‚îú‚îÄ‚îÄ 01-Preinstall.yml             # Instaluje z√°kladn√≠ bal√≠ƒçky (wget, git, unzip, atd.)
‚îÇ   ‚îú‚îÄ‚îÄ 02-PHP-7.4.yml                # Instaluje PHP 7.4 a roz≈°√≠≈ôen√≠ (star≈°√≠ mo≈ænost)
‚îÇ   ‚îú‚îÄ‚îÄ 02-PHP-8.1.yml                # Instaluje PHP 8.1 a roz≈°√≠≈ôen√≠ (v√Ωchoz√≠)
‚îÇ   ‚îú‚îÄ‚îÄ 03-MariaDB.yml                # Instaluje MariaDB server a klienta, nastav√≠ root heslo
‚îÇ   ‚îú‚îÄ‚îÄ 04-iTop-3.1.1.yml             # Instaluje iTop 3.1.1 (star≈°√≠ mo≈ænost)
‚îÇ   ‚îú‚îÄ‚îÄ 04-iTop-3.1.2.yml             # Instaluje iTop 3.1.2 (star≈°√≠ mo≈ænost)
‚îÇ   ‚îú‚îÄ‚îÄ 04-iTop-3.2.0.yml             # Instaluje iTop 3.2.0 (v√Ωchoz√≠)
‚îÇ   ‚îú‚îÄ‚îÄ 04-iTop-3.2.0-2.yml           # Instaluje iTop 3.2.0-2 (star≈°√≠ mo≈ænost)
‚îÇ   ‚îî‚îÄ‚îÄ 05-Toolkit.yml                # St√°hne a rozbal√≠ iTop Toolkit
‚îú‚îÄ‚îÄ Skript.sh                         # Hlavn√≠ Bash skript pro orchestraci Terraformu a Ansible
‚îú‚îÄ‚îÄ Terraform/
‚îÇ   ‚îî‚îÄ‚îÄ .tf                           # Terraform konfigurace pro vytvo≈ôen√≠ Proxmox LXC
‚îú‚îÄ‚îÄ .gitignore                        # Specifikuje soubory, kter√© se nemaj√≠ sledovat Gitem
‚îî‚îÄ‚îÄ README.md                         # Tento soubor
‚îî‚îÄ‚îÄ LICENSE                           # MIT Licence pro projekt
```

-----

### Nastaven√≠ a pou≈æit√≠

1.  **Klonov√°n√≠ repozit√°≈ôe:**
    ```bash
    git clone https://github.com/YourUsername/Terraform-Ansible-Deployment.git
    cd Terraform-Ansible-Deployment
    ```
2.  **P≈ôechod do adres√°≈ôe Terraform a inicializace:**
    ```bash
    cd Terraform/
    terraform init
    ```
    **Pozn√°mka:** Pokud pou≈æ√≠v√°te promƒõnn√© pro citliv√° data, ujistƒõte se, ≈æe jsou nyn√≠ nastaveny (nap≈ô. prost≈ôednictv√≠m promƒõnn√Ωch prost≈ôed√≠ nebo souboru `.tfvars`, kter√Ω NEBUDETE commitovat).
    ```bash
    cd .. # Zpƒõt do ko≈ôenov√©ho adres√°≈ôe
    ```
3.  **√öprava `Skript.sh`:**
      * Otev≈ôete `Skript.sh` a nahraƒète `PROXMOX_IP="..."` skuteƒçnou IP adresou va≈°eho Proxmox serveru.
      * Ujistƒõte se, ≈æe cesty k va≈°emu priv√°tn√≠mu SSH kl√≠ƒçi (`/home/idk/.ssh/id_rsa`) jsou spr√°vn√© ve skriptu `Skript.sh` a v konfiguraci Terraformu.
      * **D≈Øle≈æit√©:** Zkontrolujte zakomentovan√© Ansible playbooky ve skriptu `Skript.sh`. Odkomentujte konkr√©tn√≠ verze PHP a iTopu, kter√© chcete nainstalovat. Ve v√Ωchoz√≠m nastaven√≠ jsou vybr√°ny PHP 8.1 a iTop 3.2.0.
4.  **Spu≈°tƒõn√≠ hlavn√≠ho nasazovac√≠ho skriptu:**
    ```bash
    chmod +x Skript.sh
    ./Skript.sh
    ```
    Skript provede:
      * Spust√≠ `terraform apply` pro vytvo≈ôen√≠ LXC kontejneru.
      * Z√≠sk√° VMID a IP adresu LXC.
      * Spust√≠ LXC p≈ôes SSH.
      * Dynamicky aktualizuje soubor `ansible/hosts.ini` s novou IP adresou LXC.
      * Spust√≠ vybran√© Ansible playbooky pro instalaci a konfiguraci softwaru.
      * P≈ôejmenuje LXC kontejner.
      * Vyp√≠≈°e koneƒçnou IP adresu nasazen√© instance iTop.

-----

### Po nasazen√≠

  * Jakmile skript dokonƒç√≠, m≈Ø≈æete p≈ôistupovat k va≈°√≠ instanci iTop pomoc√≠ zobrazen√© IP adresy ve va≈°em webov√©m prohl√≠≈æeƒçi. Pot√© budete muset dokonƒçit webov√©ho pr≈Øvodce instalac√≠ iTopu.
  * Nezapome≈àte vyƒçistit soubor `ansible/hosts.ini`, pokud skript spust√≠te v√≠cekr√°t, nebo zva≈æte p≈ôid√°n√≠ logiky do `Skript.sh` pro odstranƒõn√≠ star√Ωch z√°znam≈Ø p≈ôed p≈ôid√°n√≠m nov√Ωch.

-----
